<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AYUDA</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .header {
            background-color: #343a40;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .section-card {
            margin-bottom: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            height: 100%;
        }
        .section-title {
            background-color: #6c757d;
            color: white;
            padding: 1rem;
            margin-bottom: 0;
        }
        .section-body {
            padding: 1.5rem;
            background-color: white;
            height: calc(100% - 56px);
            display: flex;
            flex-direction: column;
        }
        .qr-container {
            text-align: center;
            padding: 1rem;
        }
        .qr-image {
            max-width: 200px;
            margin-bottom: 1rem;
        }
        .alarm-active {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        .excel-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
        }
        .contingency-card {
            border-left: 5px solid #dc3545;
        }
        .contingency-title {
            background-color: #dc3545 !important;
        }
        .card-content {
            flex-grow: 1;
        }
        .row-spacing {
            margin-bottom: 15px;
        }
        .horizontal-row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -7.5px;
            margin-left: -7.5px;
        }
        .horizontal-col {
            padding-right: 7.5px;
            padding-left: 7.5px;
            flex: 0 0 50%;
            max-width: 50%;
        }
        @media (max-width: 768px) {
            .horizontal-col {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }
        .tab-inactive .tab-active-only {
            opacity: 0.7;
        }
        #alarm-sound {
            display: none;
        }
    </style>

    <style>
        .feria_del_libro {
            background-color: #F4D03F;
background-image: linear-gradient(132deg, #F4D03F 0%, #16a04b 100%);

        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header text-center feria_del_libro">
        <h1><i class="fas fa-book-open me-2"></i>AYUDA</h1>
        <p class="lead">Recursos de ayuda y atención al público</p>
    </div>

    <div class="container">
        <!-- Primera fila horizontal -->
        <div class="row horizontal-row row-spacing">
            <!-- Formulario de Registro -->
            <div class="col-md-6 horizontal-col">
                <div class="section-card">
                    <h3 class="section-title"><i class="fas fa-clipboard-list me-2"></i>Registro de Atención</h3>
                    <div class="section-body">
                        <div class="card-content">
                            <p>Por favor complete este formulario cada vez que termine con una atencion:</p>
                            <div class="ratio ratio-16x9">
                                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSf4wcHjKPvAhYxnoGwGvsQCJlSCD2Uld8JVPrVDqxnOj3I4FQ/viewform?embedded=true" width="300" height="300" frameborder="0" marginheight="0" marginwidth="0">Cargando…</iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reloj de Atención -->
            <div class="col-md-6 horizontal-col">
                <div class="section-card" id="reloj-section">
                    <h3 class="section-title"><i class="fas fa-clock me-2"></i>Reloj de Atención</h3>
                    <div class="section-body">
                        <div class="card-content text-center">
                            <div class="display-4 mb-3" id="reloj">00:00:00</div>
                            <div class="mb-3">
                                <span id="alarm-status" class="badge bg-secondary">Alarma inactiva</span>
                                <span id="tab-status" class="badge bg-info ms-2">Pestaña activa</span>
                            </div>
                            <button id="toggle-alarm" class="btn btn-primary mb-3">
                                <i class="fas fa-bell me-2"></i>Activar Alarma (20 min)
                            </button>
                            <div class="alert alert-info mt-auto tab-active-only">
                                <i class="fas fa-info-circle me-2"></i>
                                La alarma sonará cada 20 minutos para recordar los cambios de turno.
                            </div>
                        </div>
                        <!-- Audio oculto -->
                        <audio id="alarm-sound" preload="auto">
                            <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
                        </audio>
                    </div>
                </div>
            </div>
        </div>

        <!-- Segunda fila horizontal -->
        <div class="row horizontal-row row-spacing">
            <!-- WhatsApp Principal -->
            <div class="col-md-6 horizontal-col">
                <div class="section-card">
                    <h3 class="section-title"><i class="fab fa-whatsapp me-2"></i>Contacte a un Agente</h3>
                    <div class="section-body">
                        <div class="card-content">
                            <div class="row">
                                <div class="col-12 qr-container">
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://wa.me/5491112345678?text=Hola%20Feria%20del%20Libro,%20soy%20[Usuario]" alt="QR de WhatsApp" class="qr-image img-fluid">
                                    <p>Un agente le ayudara a activar orecuperar una cuenta</p>
                                </div>
                                <div class="col-12">
                                    <div class="alert alert-success">
                                        <strong>Hola, [nombre de usuario] O [email_del_usuario]</strong>
                                    </div>
                                    <a href="https://wa.me/5491112345678?text=Hola%20Feria%20del%20Libro,%20soy%20[Usuario]" class="btn btn-success w-100">
                                        <i class="fab fa-whatsapp me-2"></i>Abrir WhatsApp
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WhatsApp Contingencia -->
            <div class="col-md-6 horizontal-col">
                <div class="section-card contingency-card">
                    <h3 class="section-title contingency-title"><i class="fas fa-exclamation-triangle me-2"></i>En caso de emergencia</h3>
                    <div class="section-body">
                        <div class="card-content">
                         
                            <div class="row">
                                <div class="col-12 qr-container">
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://chat.whatsapp.com/ABC123DEF456" alt="QR de WhatsApp Contingencia" class="qr-image img-fluid">
                                <p>Un miembro del STAFF le ayudar con su consulta</p>
                                </div>
                                <div class="col-12">
                                   <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        <strong>Uso exclusivo en caso de falla del contacto principal</strong>
                                    </div>
                                    <a href="https://chat.whatsapp.com/ABC123DEF456" class="btn btn-outline-danger w-100">
                                        <i class="fab fa-whatsapp me-2"></i>Unirse al grupo
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

   

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-4 feria_de_libro">
        <p class="mb-0">Ayuda al Usuario stand de FamilySearch en la 49 Feria del Libro</p>
    </footer>

    <!-- Bootstrap JS y dependencias -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Variables globales
        let alarmActive = false;
        let nextAlarmTime = 0;
        let alarmTimeout;
        const alarmSound = document.getElementById('alarm-sound');
        const toggleButton = document.getElementById('toggle-alarm');
        const alarmStatus = document.getElementById('alarm-status');
        const tabStatus = document.getElementById('tab-status');
        const relojSection = document.getElementById('reloj-section');
        
        // Configurar el audio para sonar fuerte
        alarmSound.volume = 1.0; // Volumen máximo
        
        // Verificar estado de la pestaña
        let tabActive = !document.hidden;
        updateTabStatus();
        
        document.addEventListener('visibilitychange', () => {
            tabActive = !document.hidden;
            updateTabStatus();
        });

        function updateTabStatus() {
            if (tabActive) {
                tabStatus.textContent = "Pestaña activa";
                tabStatus.className = "badge bg-info ms-2";
                document.body.classList.remove('tab-inactive');
            } else {
                tabStatus.textContent = "Pestaña inactiva";
                tabStatus.className = "badge bg-warning text-dark ms-2";
                document.body.classList.add('tab-inactive');
            }
        }

        // Reloj
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('reloj').textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        setInterval(updateClock, 1000);
        updateClock();
        
        // Función para programar la próxima alarma
        function scheduleNextAlarm() {
            if (!alarmActive) return;
            
            const now = new Date();
            const twentyMinutes = 20 * 60 * 1000; // 20 minutos en milisegundos
            
            // Calcular el próximo tiempo de alarma
            nextAlarmTime = now.getTime() + twentyMinutes;
            
            // Limpiar timeout anterior si existe
            if (alarmTimeout) clearTimeout(alarmTimeout);
            
            // Programar la próxima alarma
            alarmTimeout = setTimeout(() => {
                playAlarm();
                scheduleNextAlarm(); // Programar la siguiente alarma
            }, twentyMinutes);
            
            console.log(`Alarma programada para: ${new Date(nextAlarmTime).toLocaleTimeString()}`);
        }
        
        // Función para tocar la alarma
        function playAlarm() {
            console.log("¡Alarma sonando!");
            
            // Reproducir sonido
            alarmSound.currentTime = 0; // Reiniciar audio
            alarmSound.play().catch(e => console.error("Error al reproducir alarma:", e));
            
            // Efecto visual
            relojSection.classList.add('alarm-active');
            
            // Mostrar notificación si la pestaña no está activa
            if (!tabActive) {
                showNotification();
            }
            
            // Detener alarma después de 5 segundos
            setTimeout(() => {
                stopAlarm();
            }, 5000);
        }
        
        // Función para detener la alarma
        function stopAlarm() {
            alarmSound.pause();
            alarmSound.currentTime = 0;
            relojSection.classList.remove('alarm-active');
        }
        
        // Función para mostrar notificación
        function showNotification() {
            if (!("Notification" in window)) return;
            
            if (Notification.permission === "granted") {
                new Notification("¡Alarma de la Feria del Libro!", {
                    body: "Es hora de realizar el cambio de turno",
                    icon: "https://cdn-icons-png.flaticon.com/512/1828/1828508.png"
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification("¡Alarma de la Feria del Libro!", {
                            body: "Es hora de realizar el cambio de turno",
                            icon: "https://cdn-icons-png.flaticon.com/512/1828/1828508.png"
                        });
                    }
                });
            }
        }
        
        // Función para activar/desactivar la alarma
        function toggleAlarm() {
            if (alarmActive) {
                // Desactivar alarma
                alarmActive = false;
                stopAlarm();
                clearTimeout(alarmTimeout);
                toggleButton.innerHTML = '<i class="fas fa-bell me-2"></i>Activar Alarma (20 min)';
                toggleButton.className = 'btn btn-primary';
                alarmStatus.textContent = 'Alarma inactiva';
                alarmStatus.className = 'badge bg-secondary';
            } else {
                // Activar alarma
                alarmActive = true;
                toggleButton.innerHTML = '<i class="fas fa-bell-slash me-2"></i>Desactivar Alarma';
                toggleButton.className = 'btn btn-danger';
                alarmStatus.textContent = 'Alarma activa (sonará cada 20 min)';
                alarmStatus.className = 'badge bg-success';
                
                // Programar la primera alarma
                scheduleNextAlarm();
                
                // Solicitar permisos para notificaciones
                if ("Notification" in window && Notification.permission !== "granted" && Notification.permission !== "denied") {
                    Notification.requestPermission();
                }
            }
        }
        
        // Event listeners
        toggleButton.addEventListener('click', toggleAlarm);
        
        // Detener alarma al hacer clic en la sección
        relojSection.addEventListener('click', function() {
            if (!alarmSound.paused) {
                stopAlarm();
            }
        });
        
        // Precargar el sonido de alarma
        window.addEventListener('load', () => {
            // Esta línea fuerza la precarga del audio
            alarmSound.volume = 0;
            alarmSound.play().then(() => {
                alarmSound.pause();
                alarmSound.currentTime = 0;
                alarmSound.volume = 1.0;
            }).catch(e => console.log("Precarga de audio:", e));
        });
    </script>
</body>
</html>
