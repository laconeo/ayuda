<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>River Ride - Retro Edition</title>
    <style>
        :root {
            --river-blue: #0055ff;
            --grass-green: #00aa00;
            --ui-bg: #222;
            --text-color: #fff;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #333;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            border: 10px solid #555;
            background-color: var(--river-blue);
        }

        canvas {
            display: block;
            image-rendering: pixelated;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            box-sizing: border-box;
            color: var(--text-color);
            text-shadow: 2px 2px #000;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: bold;
        }

        #fuel-gauge-container {
            width: 200px;
            height: 20px;
            background: #000;
            border: 2px solid #fff;
            position: relative;
            margin: 0 auto 20px auto;
        }

        #fuel-fill {
            height: 100%;
            background: #f00;
            width: 100%;
            transition: width 0.1s linear;
        }

        #fuel-label {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 0;
            font-size: 14px;
            line-height: 20px;
        }

        #start-screen, #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 30px;
            text-align: center;
            border: 4px solid var(--grass-green);
            pointer-events: auto;
        }

        button {
            background: var(--grass-green);
            color: white;
            border: none;
            padding: 15px 30px;
            font-family: inherit;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
        }

        button:hover {
            background: #00cc00;
        }

        .controls-hint {
            margin-top: 20px;
            font-size: 14px;
            color: #aaa;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-overlay">
        <div class="stats">
            <div>PUNTOS: <span id="score-val">0</span></div>
            <div>HI: <span id="hi-score-val">0</span></div>
        </div>
        
        <div style="flex-grow: 1;"></div>

        <div>
            <div id="fuel-gauge-container">
                <div id="fuel-fill"></div>
                <div id="fuel-label">FUEL</div>
            </div>
        </div>
    </div>

    <div id="start-screen">
        <h1>RIVER RIDE</h1>
        <p>Estilo 16-Bit Retro</p>
        <div class="controls-hint">
            PC: Flechas para mover, Espacio para disparar<br>
            MÓVIL: Toca los lados para mover y centro para disparar
        </div>
        <button onclick="startGame()">INICIAR MISIÓN</button>
    </div>

    <div id="game-over" style="display: none;">
        <h1>¡AVIÓN DESTRUIDO!</h1>
        <p>Puntuación Final: <span id="final-score">0</span></p>
        <button onclick="startGame()">REINTENTAR</button>
    </div>
</div>

<script>
    /** @type {HTMLCanvasElement} */
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score-val');
    const hiScoreElement = document.getElementById('hi-score-val');
    const finalScoreElement = document.getElementById('final-score');
    const fuelFill = document.getElementById('fuel-fill');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over');

    // Configuración del juego
    const GAME_WIDTH = 400;
    const GAME_HEIGHT = 600;
    canvas.width = GAME_WIDTH;
    canvas.height = GAME_HEIGHT;

    let score = 0;
    let hiScore = localStorage.getItem('riverRideHiScore') || 0;
    hiScoreElement.textContent = hiScore;
    
    let gameActive = false;
    let fuel = 100;
    let scrollSpeed = 2;
    let scrollOffset = 0;
    let distanceTraveled = 0;

    // Estado del jugador
    const player = {
        x: GAME_WIDTH / 2 - 15,
        y: GAME_HEIGHT - 80,
        w: 30,
        h: 30,
        speed: 4,
        dx: 0,
        dy: 0
    };

    let bullets = [];
    let enemies = [];
    let particles = [];
    let riverBanks = [];

    // Inputs
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // Soporte táctil básico
    canvas.addEventListener('touchstart', handleTouch);
    function handleTouch(e) {
        if (!gameActive) return;
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        
        if (x < GAME_WIDTH / 3) player.dx = -player.speed;
        else if (x > (GAME_WIDTH / 3) * 2) player.dx = player.speed;
        else shoot();
    }
    canvas.addEventListener('touchend', () => player.dx = 0);

    // --- GENERACIÓN DE RÍO ---
    function initRiver() {
        riverBanks = [];
        for (let i = 0; i < (GAME_HEIGHT / 20) + 5; i++) {
            riverBanks.push(generateRiverSegment(i * 20));
        }
    }

    function generateRiverSegment(y) {
        // El río se estrecha y ensancha
        const noise = Math.sin(distanceTraveled / 500 + y / 100) * 40;
        const width = 150 + Math.sin(distanceTraveled / 1000) * 30;
        const centerX = (GAME_WIDTH / 2) + noise;
        
        return {
            y: y,
            left: centerX - width / 2,
            right: centerX + width / 2
        };
    }

    // --- SPRITES (SVG paths convertidos a funciones de dibujo) ---
    function drawPlayer(x, y) {
        ctx.fillStyle = '#fff'; // Fuselaje
        ctx.fillRect(x + 12, y, 6, 30);
        ctx.fillStyle = '#f00'; // Alas
        ctx.fillRect(x, y + 15, 30, 6);
        ctx.fillStyle = '#00f'; // Cabina
        ctx.fillRect(x + 13, y + 5, 4, 6);
    }

    function drawEnemy(type, x, y) {
        if (type === 'ship') {
            ctx.fillStyle = '#777';
            ctx.fillRect(x, y + 5, 40, 15);
            ctx.fillStyle = '#333';
            ctx.fillRect(x + 10, y, 20, 10);
        } else if (type === 'heli') {
            ctx.fillStyle = '#aa0';
            ctx.fillRect(x + 5, y + 5, 20, 15);
            ctx.fillStyle = '#000'; // Hélice
            const rotorWidth = 30 + Math.sin(Date.now() / 20) * 10;
            ctx.fillRect(x + 15 - rotorWidth/2, y, rotorWidth, 2);
        } else if (type === 'fuel') {
            ctx.fillStyle = '#fff';
            ctx.fillRect(x, y, 30, 40);
            ctx.fillStyle = '#f00';
            ctx.font = 'bold 10px Arial';
            ctx.fillText('FUEL', x + 1, y + 25);
        }
    }

    function createExplosion(x, y, color) {
        for (let i = 0; i < 8; i++) {
            particles.push({
                x, y,
                vx: (Math.random() - 0.5) * 5,
                vy: (Math.random() - 0.5) * 5,
                life: 20,
                color: color || '#ff0'
            });
        }
    }

    function spawnEnemy() {
        if (Math.random() > 0.02) return;
        
        const segment = riverBanks[0];
        const types = ['ship', 'heli', 'fuel'];
        const type = types[Math.floor(Math.random() * types.length)];
        
        const w = type === 'ship' ? 40 : 30;
        const x = segment.left + Math.random() * (segment.right - segment.left - w);
        
        enemies.push({
            type, x, y: -50, w, h: type === 'fuel' ? 40 : 20, 
            speed: type === 'heli' ? 1 : 0
        });
    }

    function shoot() {
        if (bullets.length < 3) {
            bullets.push({ x: player.x + player.w / 2 - 2, y: player.y, w: 4, h: 10 });
        }
    }

    function startGame() {
        score = 0;
        fuel = 100;
        gameActive = true;
        player.x = GAME_WIDTH / 2 - 15;
        enemies = [];
        bullets = [];
        particles = [];
        distanceTraveled = 0;
        scrollSpeed = 2;
        initRiver();
        
        scoreElement.textContent = '0';
        startScreen.style.display = 'none';
        gameOverScreen.style.display = 'none';
        
        requestAnimationFrame(update);
    }

    function endGame() {
        gameActive = false;
        if (score > hiScore) {
            hiScore = score;
            localStorage.setItem('riverRideHiScore', hiScore);
            hiScoreElement.textContent = hiScore;
        }
        finalScoreElement.textContent = score;
        gameOverScreen.style.display = 'block';
    }

    function update() {
        if (!gameActive) return;

        // Movimiento jugador
        if (keys['ArrowLeft']) player.dx = -player.speed;
        else if (keys['ArrowRight']) player.dx = player.speed;
        else if (!('ontouchstart' in window)) player.dx = 0;

        if (keys['ArrowUp']) scrollSpeed = 4;
        else if (keys['ArrowDown']) scrollSpeed = 1;
        else scrollSpeed = 2;

        if (keys['Space']) shoot();

        player.x += player.dx;
        
        // Límites de pantalla
        if (player.x < 0) player.x = 0;
        if (player.x + player.w > GAME_WIDTH) player.x = GAME_WIDTH - player.w;

        // Combustible
        fuel -= 0.05 * (scrollSpeed / 2);
        if (fuel <= 0) {
            createExplosion(player.x + 15, player.y + 15, '#fff');
            endGame();
        }
        fuelFill.style.width = fuel + '%';
        fuelFill.style.backgroundColor = fuel < 25 ? '#f00' : '#0f0';

        // Actualizar Río
        distanceTraveled += scrollSpeed;
        scrollOffset += scrollSpeed;
        if (scrollOffset >= 20) {
            scrollOffset = 0;
            riverBanks.pop();
            riverBanks.unshift(generateRiverSegment(-20));
        }

        // Colisión con riberas
        const playerMidY = player.y + 15;
        const currentSegment = riverBanks.find(s => s.y + scrollOffset >= player.y && s.y + scrollOffset <= player.y + 30);
        if (currentSegment) {
            if (player.x < currentSegment.left || player.x + player.w > currentSegment.right) {
                createExplosion(player.x + 15, player.y + 15, '#f00');
                endGame();
            }
        }

        // Balas
        bullets.forEach((b, i) => {
            b.y -= 8;
            if (b.y < 0) bullets.splice(i, 1);
        });

        // Enemigos
        enemies.forEach((e, i) => {
            e.y += scrollSpeed;
            if (e.type === 'heli') e.x += Math.sin(Date.now() / 200) * 2;
            
            // Colisión bala-enemigo
            bullets.forEach((b, bi) => {
                if (b.x < e.x + e.w && b.x + b.w > e.x && b.y < e.y + e.h && b.y + b.h > e.y) {
                    createExplosion(e.x + e.w/2, e.y + e.h/2);
                    bullets.splice(bi, 1);
                    enemies.splice(i, 1);
                    score += e.type === 'fuel' ? 50 : 100;
                    scoreElement.textContent = score;
                }
            });

            // Colisión jugador-enemigo
            if (player.x < e.x + e.w && player.x + player.w > e.x && player.y < e.y + e.h && player.y + player.h > e.y) {
                if (e.type === 'fuel') {
                    fuel = Math.min(100, fuel + 0.5); // Repostar al pasar por encima
                } else {
                    createExplosion(player.x + 15, player.y + 15);
                    endGame();
                }
            }

            if (e.y > GAME_HEIGHT) enemies.splice(i, 1);
        });

        // Partículas
        particles.forEach((p, i) => {
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
            if (p.life <= 0) particles.splice(i, 1);
        });

        spawnEnemy();
        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

        // Dibujar Río (Agua ya es el fondo azul)
        ctx.fillStyle = '#00aa00'; // Color césped
        riverBanks.forEach(s => {
            const drawY = s.y + scrollOffset;
            ctx.fillRect(0, drawY, s.left, 21);
            ctx.fillRect(s.right, drawY, GAME_WIDTH - s.right, 21);
            
            // Bordes de tierra
            ctx.fillStyle = '#008800';
            ctx.fillRect(s.left - 4, drawY, 4, 21);
            ctx.fillRect(s.right, drawY, 4, 21);
            ctx.fillStyle = '#00aa00';
        });

        // Dibujar Balas
        ctx.fillStyle = '#ff0';
        bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

        // Dibujar Enemigos
        enemies.forEach(e => drawEnemy(e.type, e.x, e.y));

        // Dibujar Jugador
        drawPlayer(player.x, player.y);

        // Dibujar Partículas
        particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life / 20;
            ctx.fillRect(p.x, p.y, 4, 4);
        });
        ctx.globalAlpha = 1.0;
    }

</script>

</body>
</html>
